<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live | STOLAR CARP</title>

  <link rel="stylesheet" href="assets/css/main.css">
  <script defer src="assets/js/config.js"></script>

  <style>
    body { background:#020617; }
    .live-wrap{max-width:1100px;margin:80px auto 40px;padding:0 14px;}
    .stage-title{text-align:center;margin-bottom:18px;font-size:1.35rem;}
    .zone-title{text-align:left;margin:32px 0 8px;font-size:1.1rem;}

    table{width:100%;border-collapse:collapse;font-size:.9rem;}
    th,td{
      border:1px solid rgba(148,163,184,.4);
      padding:6px 4px;
      text-align:center;
    }
    th{
      background:#111827;
      color:#e5e7eb;
      font-weight:600;
    }
    tbody tr:nth-child(even){
      background:rgba(15,23,42,.7);
    }
    tbody tr:nth-child(odd){
      background:rgba(15,23,42,.4);
    }
    .big-max{
      font-weight:700;
      color:#facc15;
    }
    .status{
      margin-top:10px;
      font-size:.9rem;
      color:#9ca3af;
      text-align:center;
    }
  </style>
</head>

<body>

<header class="header">
  <div class="container header__row">
    <a class="logo" href="index.html">
      <span class="logo__mark">SC</span>
      <span class="logo__text">STOLAR CARP</span>
    </a>
    <nav class="nav" id="nav">
      <a href="index.html" class="nav__link">Головна</a>
      <a href="rules.html" class="nav__link">Регламент</a>
      <a href="register.html" class="nav__link">Реєстрація</a>
      <a href="live.html" class="nav__link nav__link--active">Live</a>
      <a href="rating.html" class="nav__link">Рейтинг</a>
    </nav>
    <button class="burger" id="burger"><span></span><span></span><span></span></button>
  </div>
</header>

<main class="live-wrap">
  <div class="stage-title" id="stageTitle">LIVE результати</div>

  <!-- ЗОНА A -->
  <h2 class="zone-title">Зона A</h2>
  <table>
    <thead>
      <tr>
        <th>Місце</th>
        <th>Команда</th>
        <th>К-сть риб</th>
        <th>Загальна вага</th>
        <th>Big Fish</th>
      </tr>
    </thead>
    <tbody id="zoneA"></tbody>
  </table>

  <!-- ЗОНА B -->
  <h2 class="zone-title">Зона B</h2>
  <table>
    <thead>
      <tr>
        <th>Місце</th>
        <th>Команда</th>
        <th>К-сть риб</th>
        <th>Загальна вага</th>
        <th>Big Fish</th>
      </tr>
    </thead>
    <tbody id="zoneB"></tbody>
  </table>

  <!-- ЗОНА C -->
  <h2 class="zone-title">Зона C</h2>
  <table>
    <thead>
      <tr>
        <th>Місце</th>
        <th>Команда</th>
        <th>К-сть риб</th>
        <th>Загальна вага</th>
        <th>Big Fish</th>
      </tr>
    </thead>
    <tbody id="zoneC"></tbody>
  </table>

  <!-- BIG FISH TOTAL -->
  <h2 class="zone-title">Big Fish — підсумок по етапу</h2>
  <table>
    <thead>
      <tr>
        <th>Команда</th>
        <th>BIG 1 день</th>
        <th>BIG 2 день</th>
        <th>MAX Big</th>
      </tr>
    </thead>
    <tbody id="bigFishTotal"></tbody>
  </table>

  <div class="status" id="liveStatus"></div>
</main>

<script>
  // ⚠️ Заміни, якщо інший URL Cloud Function
  const API_URL = "https://us-central1-stolar-carp.cloudfunctions.net/stolarcarpApi";

  const stageTitle = document.getElementById("stageTitle");
  const zoneA = document.getElementById("zoneA");
  const zoneB = document.getElementById("zoneB");
  const zoneC = document.getElementById("zoneC");
  const bigFishBody = document.getElementById("bigFishTotal");
  const liveStatus = document.getElementById("liveStatus");

  function renderZone(tbody, rows) {
    tbody.innerHTML = "";
    if (!rows || !rows.length) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 5;
      td.textContent = "Поки що немає результатів у цій зоні.";
      tr.appendChild(td);
      tbody.appendChild(tr);
      return;
    }

    rows.forEach(r => {
      const tr = document.createElement("tr");
      const cells = [
        r.place || "",
        r.team || "",
        r.count || "",
        r.weight || "",
        r.big || ""
      ];
      cells.forEach(val => {
        const td = document.createElement("td");
        td.textContent = val;
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  function renderBigFish(rows) {
    bigFishBody.innerHTML = "";
    if (!rows || !rows.length) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 4;
      td.textContent = "Дані Big Fish відсутні.";
      tr.appendChild(td);
      bigFishBody.appendChild(tr);
      return;
    }

    rows.forEach(r => {
      const tr = document.createElement("tr");
      const tdTeam = document.createElement("td");
      tdTeam.textContent = r.team || "";
      tr.appendChild(tdTeam);

      const tdB1 = document.createElement("td");
      tdB1.textContent = r.big1Day || "";
      tr.appendChild(tdB1);

      const tdB2 = document.createElement("td");
      tdB2.textContent = r.big2Day || "";
      tr.appendChild(tdB2);

      const tdMax = document.createElement("td");
      tdMax.textContent = r.teamMaxBig || "";
      if (r.isMax) tdMax.classList.add("big-max");
      tr.appendChild(tdMax);

      bigFishBody.appendChild(tr);
    });
  }

  async function loadLive() {
    liveStatus.textContent = "Оновлення LIVE...";
    try {
      const res = await fetch(API_URL + "?action=live");
      const data = await res.json();

      if (!data || !data.data) {
        liveStatus.textContent = "Помилка: некоректна відповідь сервера.";
        return;
      }

      stageTitle.textContent = "LIVE результати — " + (data.stage || "STOLAR CARP 2026");

      const zones = data.data.zones || { A: [], B: [], C: [] };
      renderZone(zoneA, zones.A);
      renderZone(zoneB, zones.B);
      renderZone(zoneC, zones.C);

      renderBigFish(data.data.bigFishTotal || []);

      liveStatus.textContent = "Останнє оновлення: " + new Date().toLocaleTimeString();
    } catch (err) {
      console.error(err);
      liveStatus.textContent = "❌ Помилка завантаження LIVE. Перевір Cloud Function і мережу.";
    }
  }

  loadLive();
  setInterval(loadLive, 15000);
</script>

</body>
</html>
