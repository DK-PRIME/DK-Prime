<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>DK Prime · Панель організатора</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --bg:#020617;
      --surface:#020617;
      --card:#020617;
      --card2:#020617;
      --border:rgba(148,163,184,.45);
      --accent:#facc15;
      --accent-soft:rgba(250,204,21,.08);
      --error:#f97373;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --shadow:0 22px 60px rgba(0,0,0,.9);
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 48%,#020617 100%);
      color:var(--text);
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:rgba(15,23,42,.96);
      backdrop-filter:blur(14px);
      border-bottom:1px solid rgba(148,163,184,.35);
      padding:10px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .logo-wrap{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .logo{
      font-weight:700;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:.78rem;
    }
    .logo-sub{
      font-size:.75rem;
      color:var(--muted);
    }
    .role-label{
      font-size:.8rem;
      color:var(--muted);
    }
    button.logout{
      border-radius:999px;
      border:1px solid rgba(148,163,184,.7);
      background:transparent;
      color:var(--text);
      padding:6px 14px;
      font-size:.8rem;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
    }

    main{
      padding:18px 16px 32px;
      max-width:1100px;
      margin:0 auto;
    }

    #systemMessage{
      margin-bottom:10px;
      font-size:.86rem;
      min-height:1.2em;
    }

    .layout{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media(min-width:880px){
      .layout{
        flex-direction:row;
        align-items:flex-start;
      }
      .col-left{flex:1.1;}
      .col-right{flex:1;}
    }

    .card{
      background:radial-gradient(circle at top left,rgba(15,23,42,.9),#020617 55%);
      border-radius:18px;
      border:1px solid var(--border);
      padding:16px 14px 18px;
      box-shadow:var(--shadow);
    }
    .card-highlight{
      border-color:rgba(250,204,21,.55);
    }

    h2{
      margin:0 0 6px;
      font-size:1.02rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h3{
      margin:0 0 8px;
      font-size:.94rem;
    }

    .badge{
      font-size:.68rem;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--muted);
      margin-bottom:4px;
      display:inline-block;
    }
    .badge-mini{
      font-size:.66rem;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      color:var(--muted);
    }

    .hidden{display:none;}

    .muted{
      font-size:.8rem;
      color:var(--muted);
    }

    .field-label{
      display:block;
      font-size:.78rem;
      color:var(--muted);
      margin:8px 0 3px;
    }

    input, select, button{
      font-family:inherit;
      font-size:.86rem;
    }

    input[type="text"],
    input[type="number"],
    select{
      width:100%;
      padding:7px 9px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.45);
      background:#020617;
      color:var(--text);
    }
    input:disabled, select:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .btn{
      border-radius:999px;
      border:1px solid rgba(250,204,21,.85);
      background:linear-gradient(90deg,var(--accent-soft),rgba(248,113,113,.12));
      color:#fef9c3;
      padding:7px 14px;
      cursor:pointer;
      font-size:.82rem;
      white-space:nowrap;
    }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .btn-secondary{
      border-color:rgba(148,163,184,.7);
      background:transparent;
      color:var(--text);
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin-top:8px;
    }

    .chip{
      font-size:.74rem;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.55);
    }
    .chip-muted{
      background:rgba(15,23,42,.9);
      color:var(--muted);
    }
    .chip-open{
      background:rgba(22,163,74,.18);
      border-color:rgba(34,197,94,.8);
      color:#bbf7d0;
    }
    .chip-closed{
      background:rgba(127,29,29,.28);
      border-color:rgba(248,113,113,.8);
      color:#fecaca;
    }

    .subline{
      margin-top:4px;
      font-size:.8rem;
      color:var(--muted);
    }

    /* Великі вертикальні кнопки нижче */
    .big-actions{
      margin-top:22px;
    }
    .big-actions-title{
      font-size:.86rem;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--muted);
      margin-bottom:6px;
    }
    .big-btn{
      width:100%;
      padding:15px 14px;
      margin-bottom:10px;
      border-radius:18px;
      border:1px solid rgba(148,163,184,.65);
      background:radial-gradient(circle at left,rgba(148,163,184,.16),#020617 55%);
      color:var(--text);
      text-align:left;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 16px 40px rgba(0,0,0,.8);
    }
    .big-btn span.title{
      font-size:.94rem;
      font-weight:600;
    }
    .big-btn span.subtitle{
      font-size:.8rem;
      color:var(--muted);
      display:block;
      margin-top:2px;
    }
    .big-btn span.arrow{
      font-size:1.3rem;
      opacity:.85;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-wrap">
      <div class="logo">DK PRIME · CONTROL PANEL</div>
      <div class="logo-sub" id="userInfo">Перевірка доступу...</div>
    </div>
    <button class="logout" id="logoutBtn">
      <span>Вийти</span>
    </button>
  </header>

  <main>
    <div id="systemMessage"></div>

    <!-- ADMIN -->
    <section id="adminSection" class="hidden">
      <div class="layout">
        <!-- Ліва колонка: активний сезон/етап -->
        <div class="col-left">
          <div class="card card-highlight">
            <span class="badge">Активний сезон / етап</span>
            <h2>
              Керування поточним змаганням
              <span class="badge-mini">LIVE</span>
            </h2>
            <p class="muted">
              Обери сезон і етап, відкрий або закрий реєстрацію. 
              Обраний етап бачать сторінки реєстрації, жеребкування та судді.
            </p>

            <label for="seasonSelect" class="field-label">Сезон / турнір</label>
            <select id="seasonSelect" disabled>
              <option value="">Завантаження...</option>
            </select>
            <div id="seasonInfo" class="subline"></div>

            <label for="stageSelect" class="field-label" style="margin-top:10px;">Етап</label>
            <select id="stageSelect" disabled>
              <option value="">Спочатку обери сезон</option>
            </select>

            <div class="row">
              <span id="stageStatusBadge" class="chip chip-muted">Статус: не обрано</span>
              <button id="toggleStageBtn" class="btn" disabled>Відкрити реєстрацію</button>
            </div>

            <p class="subline">
              Активний етап також зберігається в <code>settings/active</code> і дублюється в <code>localStorage</code>.
              Зелений статус — відкрито, червоний — закрито.
            </p>
          </div>
        </div>

        <!-- Права колонка: створення сезону -->
        <div class="col-right">
          <div class="card">
            <span class="badge">Структура сезону</span>
            <h2>Створити новий сезон / змагання</h2>
            <p class="muted">
              Створює запис у <code>seasons</code> та етапи в <code>stages</code> (1–5 та Фінал). 
              Потім можна редагувати назви, дати та інші параметри.
            </p>

            <form id="createSeasonForm">
              <label class="field-label" for="seasonIdInput">ID сезону (наприклад: 2026)</label>
              <input type="text" id="seasonIdInput" placeholder="2026" required>

              <label class="field-label" for="seasonTitleInput">Назва сезону / турніру</label>
              <input type="text" id="seasonTitleInput" placeholder="STOLAR CARP 2026" required>

              <label class="field-label" for="seasonYearInput">Рік</label>
              <input type="number" id="seasonYearInput" placeholder="2026" required>

              <label class="field-label" for="seasonStagesInput">Кількість етапів (без фіналу)</label>
              <input type="number" id="seasonStagesInput" value="5" min="1" max="10" required>

              <div style="margin-top:10px;">
                <button type="submit" class="btn">
                  Створити сезон + етапи 1–5 та Фінал
                </button>
              </div>
            </form>

            <p class="subline">
              Після створення сезону його можна редагувати прямо у Firestore 
              або згодом додамо окрему сторінку налаштувань сезону в DK PRIME.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- JUDGE (заглушка) -->
    <section id="judgeSection" class="card hidden">
      <span class="badge">judge</span>
      <h2>Панель судді</h2>
      <p class="muted">
        Для суддів використовується окрема сторінка <code>judges.html</code>, де кожен бачить тільки свою зону (A/B/C).
        Ця сторінка використовується капітаном/адміном.
      </p>
    </section>

    <!-- NO ACCESS -->
    <section id="noAccessSection" class="card hidden">
      <span class="badge">доступ заборонено</span>
      <h2>Недостатньо прав</h2>
      <p>Ваш акаунт не має ролі admin або judge. Зверніться до організатора.</p>
    </section>

    <!-- Великі вертикальні кнопки інших дій -->
    <section id="bigActionsSection" class="big-actions hidden">
      <div class="big-actions-title">Навігація по керуванню турніром</div>

      <button class="big-btn" onclick="window.location.href='registrations.html'">
        <div>
          <span class="title">Реєстрація учасників</span>
          <span class="subtitle">Заявки на активний етап, підтвердження оплати, статус команд</span>
        </div>
        <span class="arrow">➜</span>
      </button>

      <button class="big-btn" onclick="window.location.href='draw.html'">
        <div>
          <span class="title">Жеребкування</span>
          <span class="subtitle">Розподіл підтверджених команд по зонах і секторах</span>
        </div>
        <span class="arrow">➜</span>
      </button>

      <button class="big-btn" onclick="window.location.href='judges.html'">
        <div>
          <span class="title">Зони суддів A / B / C</span>
          <span class="subtitle">Судді вносять вагу риби тільки у своїй зоні, адмін бачить усі</span>
        </div>
        <span class="arrow">➜</span>
      </button>
    </section>
  </main>

  <script type="module" src="./firebase-config.js"></script>
  <script type="module" src="./admin_judge_logic.js"></script>
</body>
</html>
